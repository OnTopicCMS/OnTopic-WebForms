/*==============================================================================================================================
| Author        Ignia, LLC
| Client        Ignia, LLC
| Project       OnTopicSample OnTopic Site
\=============================================================================================================================*/
using System;
using System.Linq;
using System.Web.UI;

namespace Ignia.Topics.Web.Host.Common.Templates {

  /*============================================================================================================================
  | CLASS: LAYOUT MASTER
  \---------------------------------------------------------------------------------------------------------------------------*/
  /// <summary>
  ///   Provides properties and functionality necessary for use with the master page template and dependent pages.
  /// </summary>
  public partial class Layout: System.Web.UI.MasterPage {


    /*==========================================================================================================================
    | PAGE LOAD
    \-------------------------------------------------------------------------------------------------------------------------*/
    void Page_Load(Object Src, EventArgs E) {

      /*------------------------------------------------------------------------------------------------------------------------
      | Set page title
      \-----------------------------------------------------------------------------------------------------------------------*/
      Page.Title                        = Page.Title;

      /*------------------------------------------------------------------------------------------------------------------------
      | Set data sources
      \-----------------------------------------------------------------------------------------------------------------------*/
      Attributes.DataSource     = PageTopic.Attributes.Where(t => t.Key != "Body");
      Relationships.DataSource  = PageTopic.Relationships;

      /*------------------------------------------------------------------------------------------------------------------------
      | Ensure data binding
      \-----------------------------------------------------------------------------------------------------------------------*/
      this.DataBind();

    }

    /*==========================================================================================================================
    | PROPERTY: PAGE TOPIC
    \-------------------------------------------------------------------------------------------------------------------------*/
    /// <summary>
    ///   Identifies the topic associated with the page based on the RouteData.  If the topic cannot be identified then a null
    ///   reference is returned.
    /// </summary>
    public Topic PageTopic {
      get {
        if (Page is TopicPage) {
          return ((TopicPage)Page).Topic;
        }
        return TopicRepository.DataProvider.Load("Web");
      }
    }

  }
}